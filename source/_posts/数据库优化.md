---
title: 数据库优化
date: 2024-12-21 10:12:27
tags:
- Java
- Mysql
- 性能调优
categories: 后端开发
---

在工作过程中学会的一些性能调优相关

<!-- more -->

#### 命名规范

##### 类(class),结构(struct),枚举(enum),标签(Attribute)

###### 静态,私有,保护,公有

单词首字母大写

比如: Main, CharacterController

##### 接口(interface)

###### 静态,私有,保护,公有

首字符I开头,单词首字母大写

比如: IParse, IState

##### 常量(const)

###### 静态,私有,保护,公有

全体单词大写,单词与单词之间用_隔开

比如: NAME_GAME_OBJECT

##### 变量(field)和属性(property)

###### 静态,私有

首字符s_开头,后面单词首字母大写

比如: s_Transform, s_GameObject

###### 公有,保护

首字符m_开头,后面单词首字母大写

比如: m_Transform, m_GameObject

###### 其他

首字母小写,后面单词首字母大写

比如: transform, gameObject

##### 委托(delegate)和事件(event)名

###### 静态,私有

首字符s_开头,后面单词首字母大写

比如: s_OnDownloadComplete

###### 公有,保护

首字符m_开头,后面单词首字母大写

比如: m_OnDownloadComplete

###### 其他

首单词on开头,后面单词首字母大写

比如: onDownloadComplete

##### 函数(function)

###### 静态,私有,保护,公有

单词首字母大写

比如: Update, OnGUI

##### 回调函数(callback)

###### 静态,私有,保护,公有

首单词On开头,后面单词首字母大写

比如: OnUpdate, OnTimerCallback

## 数据库优化

### 慢sql优化

#### 查询优化

##### 索引

###### 单列索引

where\order by\group by 常用的字段创建单列索引

###### 组合索引

涉及多列条件查询创建组合索引，注意符合最左前缀匹配原则

最左前缀匹配原则:

###### 覆盖索引

查询的字段被索引全部覆盖，不用访问表

###### 避免过度索引

过多索引导致INSERT\UPDATE\DELETE开销变大

##### 优化查询语句

###### 减少使用`select *`

###### 减少在where中对字段进行函数操作 

如`where year(ts)=2024` 应改成 `where ts>='2024-01-01' and ts<='2024-12-31'`

###### 减少在where中使用OR

OR会全表扫描，替换成IN或子查询

###### 减少子查询

使用JOIN替代子查询

###### 合理使用JOIN

多表关联查询需要关联的字段有索引，连接顺序需要小表驱动大表(小表在左，大表在右)

##### 分页查询

###### limit offset

使用索引定位起始位置

比如`WHERE id > last_seen_id LIMIT 10`

减少数据扫描量

不要 `SELECT *`，只选择主键字段返回结果后再根据主键查询详细信息。

##### 临时表和缓存

##### 避免死锁和锁等待

#### 索引优化

#### 表结构设计优化

#### 事务和锁优化

#### 配置优化

#### 监控和调优

###### EXPLAIN分析查询语句

`EXPLAIN (SQL)`查看是否走索引

###### scheme事务分析查看慢sql

###### druid

根据业务看是否加防抖和遮罩，比如导出报表



